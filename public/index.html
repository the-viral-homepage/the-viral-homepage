<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Viral Homepage</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#666;
      --gridLine: rgba(0,0,0,.18);      /* darker so you SEE it */
      --gridBold: rgba(0,0,0,.30);      /* slightly darker every N cells */
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --boardBorder: rgba(0,0,0,.20);
    }

    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    header{
      padding: 28px 20px 14px;
      text-align:center;
    }
    header h1{
      margin:0;
      font-size: 44px;
      letter-spacing: -0.02em;
    }
    header p{
      margin:10px 0 0;
      color:var(--muted);
      font-size:14px;
    }

    .page{
      display:flex;
      flex-direction:column;
      align-items:center;
      padding: 10px 16px 60px;
      gap: 14px;
    }

    /* This wrapper gets scaled (so no scroll box needed) */
    #board-stage{
      width: 1000px;
      height: 1000px;
      transform-origin: top left;
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: 2px solid var(--boardBorder);  /* so you always see the board */
      background: #fff;
      position: relative;
      overflow: hidden;
    }

    /* Board background grid */
    #board{
      width:1000px;
      height:1000px;
      position:absolute;
      inset:0;

      /* visible grid:
         - light lines every 10px
         - slightly bolder lines every 50px
      */
      background-image:
        linear-gradient(to right, var(--gridLine) 1px, transparent 1px),
        linear-gradient(to bottom, var(--gridLine) 1px, transparent 1px),
        linear-gradient(to right, var(--gridBold) 1px, transparent 1px),
        linear-gradient(to bottom, var(--gridBold) 1px, transparent 1px);

      background-size:
        10px 10px,
        10px 10px,
        50px 50px,
        50px 50px;
    }

    .ad{
      position:absolute;
      border: 1px solid rgba(0,0,0,.22);
      background: #f2f2f2;
      overflow:hidden;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }

    .ad img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .controls{
      width: min(1000px, 100%);
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      color: var(--muted);
      font-size: 13px;
      padding: 0 2px;
    }
    .pill{
      padding: 6px 10px;
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 999px;
      background: rgba(0,0,0,.02);
      color: var(--text);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <header>
    <h1>The Viral Homepage</h1>
    <p>1000×1000 ad wall (data loads from <span class="pill">/api/get-ads</span>)</p>
  </header>

  <div class="page">
    <div class="controls">
      <div id="status">Loading ads…</div>
      <div class="pill">Board auto-scales on smaller screens</div>
    </div>

    <div id="board-stage">
      <div id="board"></div>
    </div>
  </div>

  <script>
    const stage = document.getElementById("board-stage");
    const board = document.getElementById("board");
    const statusEl = document.getElementById("status");

    function setScaleToFit() {
      const padding = 32;
      const availableW = window.innerWidth - padding;
      const availableH = window.innerHeight - 180;

      const scaleW = availableW / 1000;
      const scaleH = availableH / 1000;
      const scale = Math.min(1, scaleW, scaleH);

      stage.style.transform = `scale(${scale})`;
    }

    function clearBoard() {
      board.querySelectorAll(".ad").forEach(n => n.remove());
    }

    function placeAds(ads) {
      clearBoard();

      for (const ad of ads) {
        const el = document.createElement("a");
        el.className = "ad";
        el.href = ad.url || "#";
        el.target = "_blank";
        el.rel = "noopener noreferrer";
        el.title = ad.title || "Ad";

        const x = Number(ad.x) || 0;
        const y = Number(ad.y) || 0;
        const w = Number(ad.w) || 10;
        const h = Number(ad.h) || 10;

        el.style.left = x + "px";
        el.style.top  = y + "px";
        el.style.width  = w + "px";
        el.style.height = h + "px";

        if (ad.image_url) {
          const img = document.createElement("img");
          img.src = ad.image_url;
          img.alt = ad.title || "Ad image";
          el.appendChild(img);
        } else {
          el.textContent = ad.title || "";
        }

        board.appendChild(el);
      }
    }

    async function loadAds() {
      try {
        statusEl.textContent = "Loading ads…";
        const res = await fetch("/api/get-ads", { cache: "no-store" });
        const data = await res.json();

        if (!data || !data.ok) {
          statusEl.textContent = "Couldn’t load ads (API returned not-ok).";
          return;
        }

        const ads = Array.isArray(data.ads) ? data.ads : [];
        statusEl.textContent = `Loaded ${ads.length} ad(s).`;
        placeAds(ads);
      } catch (e) {
        statusEl.textContent = "Error loading ads. Check /api/get-ads.";
        console.error(e);
      }
    }

    window.addEventListener("resize", setScaleToFit);

    setScaleToFit();
    loadAds();
  </script>
</body>
</html>
